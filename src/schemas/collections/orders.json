{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Orders Collection",
  "description": "Customer order information",
  "type": "object",
  "collection": "orders",
  "indexes": [
    { "fields": { "orderNumber": 1 }, "unique": true },
    { "fields": { "customerId": 1, "orderDate": -1 } },
    { "fields": { "status": 1, "orderDate": -1 } },
    { "fields": { "orderDate": -1 } },
    { "fields": { "totalAmount": -1 } }
  ],
  "properties": {
    "_id": {
      "type": "string",
      "widget": "shortAnswer",
      "pattern": "^[0-9a-fA-F]{24}$",
      "description": "MongoDB ObjectId",
      "disabled": true
    },
    "orderNumber": {
      "type": "string",
      "widget": "shortAnswer",
      "title": "Order Number",
      "pattern": "^ORD-[0-9]{8}$",
      "description": "Unique order number",
      "format-data": "none",
      "disabled": true
    },
    "customerId": {
      "type": "string",
      "widget": "relation",
      "title": "Customer",
      "pattern": "^[0-9a-fA-F]{24}$",
      "description": "Reference to user _id",
      "typeRelation": {
        "title": "Customer",
        "_id": "users",
        "type": "n-1",
        "filter": {
          "combinator": "and",
          "rules": [],
          "id": "customer-filter"
        }
      }
    },
    "items": {
      "type": "array",
      "widget": "array",
      "title": "Order Items",
      "items": {
        "type": "object",
        "properties": {
          "productId": {
            "type": "string",
            "widget": "relation",
            "pattern": "^[0-9a-fA-F]{24}$",
            "typeRelation": {
              "title": "Product",
              "_id": "products",
              "type": "n-1",
              "filter": {
                "combinator": "and",
                "rules": [],
                "id": "product-filter"
              }
            }
          },
          "sku": {
            "type": "string",
            "widget": "shortAnswer",
            "pattern": "^.{0,50}$"
          },
          "name": {
            "type": "string",
            "widget": "shortAnswer",
            "pattern": "^.{0,200}$"
          },
          "price": {
            "type": "number",
            "widget": "numberInput",
            "minimum": 0,
            "pattern": "^\\d+(\\.\\d+)?$",
            "format-data": "money"
          },
          "quantity": {
            "type": "integer",
            "widget": "numberInput",
            "minimum": 1,
            "pattern": "^\\d+$",
            "format-data": "none"
          },
          "subtotal": {
            "type": "number",
            "widget": "numberInput",
            "minimum": 0,
            "pattern": "^\\d+(\\.\\d+)?$",
            "format-data": "money",
            "disabled": true
          }
        },
        "required": ["productId", "sku", "name", "price", "quantity", "subtotal"]
      },
      "minItems": 1
    },
    "shippingAddress": {
      "type": "object",
      "title": "Shipping Address",
      "properties": {
        "fullName": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "Full Name",
          "pattern": "^.{2,100}$"
        },
        "address": { 
          "type": "string",
          "widget": "textarea",
          "title": "Address",
          "pattern": "^[\\s\\S]{0,500}$",
          "customRole": "textarea"
        },
        "city": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "City",
          "pattern": "^.{2,50}$"
        },
        "state": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "State/Province",
          "pattern": "^.{0,50}$"
        },
        "zipCode": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "Zip/Postal Code",
          "pattern": "^.{0,20}$"
        },
        "country": { 
          "type": "string",
          "widget": "select",
          "title": "Country",
          "choices": [
            { "key": "VN", "value": "Vietnam" },
            { "key": "US", "value": "United States" },
            { "key": "GB", "value": "United Kingdom" },
            { "key": "JP", "value": "Japan" },
            { "key": "KR", "value": "South Korea" }
          ]
        },
        "phone": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "Phone",
          "pattern": "^[\\+\\d\\s\\-\\(\\)]+$",
          "format-data": "phone"
        }
      },
      "required": ["fullName", "address", "city", "country"]
    },
    "billingAddress": {
      "type": "object",
      "title": "Billing Address",
      "properties": {
        "fullName": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "Full Name",
          "pattern": "^.{2,100}$"
        },
        "address": { 
          "type": "string",
          "widget": "textarea",
          "title": "Address",
          "pattern": "^[\\s\\S]{0,500}$",
          "customRole": "textarea"
        },
        "city": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "City",
          "pattern": "^.{2,50}$"
        },
        "state": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "State/Province",
          "pattern": "^.{0,50}$"
        },
        "zipCode": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "Zip/Postal Code",
          "pattern": "^.{0,20}$"
        },
        "country": { 
          "type": "string",
          "widget": "select",
          "title": "Country",
          "choices": [
            { "key": "VN", "value": "Vietnam" },
            { "key": "US", "value": "United States" },
            { "key": "GB", "value": "United Kingdom" },
            { "key": "JP", "value": "Japan" },
            { "key": "KR", "value": "South Korea" }
          ]
        }
      },
      "required": ["fullName", "address", "city", "country"]
    },
    "payment": {
      "type": "object",
      "title": "Payment Information",
      "properties": {
        "method": {
          "type": "string",
          "widget": "select",
          "title": "Payment Method",
          "enum": ["credit_card", "debit_card", "paypal", "bank_transfer", "cash_on_delivery"],
          "choices": [
            { "key": "credit_card", "value": "Credit Card" },
            { "key": "debit_card", "value": "Debit Card" },
            { "key": "paypal", "value": "PayPal" },
            { "key": "bank_transfer", "value": "Bank Transfer" },
            { "key": "cash_on_delivery", "value": "Cash on Delivery" }
          ],
          "allowNull": false
        },
        "status": {
          "type": "string",
          "widget": "select",
          "title": "Payment Status",
          "enum": ["pending", "completed", "failed", "refunded"],
          "default": "pending",
          "choices": [
            { "key": "pending", "value": "Pending" },
            { "key": "completed", "value": "Completed" },
            { "key": "failed", "value": "Failed" },
            { "key": "refunded", "value": "Refunded" }
          ]
        },
        "transactionId": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "Transaction ID",
          "pattern": "^.{0,100}$"
        },
        "amount": { 
          "type": "number",
          "widget": "numberInput",
          "title": "Amount",
          "minimum": 0,
          "pattern": "^\\d+(\\.\\d+)?$",
          "format-data": "money"
        }
      },
      "required": ["method", "status", "amount"]
    },
    "subtotal": {
      "type": "number",
      "widget": "numberInput",
      "title": "Subtotal",
      "minimum": 0,
      "pattern": "^\\d+(\\.\\d+)?$",
      "format-data": "money",
      "disabled": true
    },
    "tax": {
      "type": "number",
      "widget": "numberInput",
      "title": "Tax",
      "minimum": 0,
      "default": 0,
      "pattern": "^\\d+(\\.\\d+)?$",
      "format-data": "money"
    },
    "shipping": {
      "type": "number",
      "widget": "numberInput",
      "title": "Shipping Cost",
      "minimum": 0,
      "default": 0,
      "pattern": "^\\d+(\\.\\d+)?$",
      "format-data": "money"
    },
    "discount": {
      "type": "number",
      "widget": "numberInput",
      "title": "Discount",
      "minimum": 0,
      "default": 0,
      "pattern": "^\\d+(\\.\\d+)?$",
      "format-data": "money"
    },
    "totalAmount": {
      "type": "number",
      "widget": "numberInput",
      "title": "Total Amount",
      "minimum": 0,
      "pattern": "^\\d+(\\.\\d+)?$",
      "format-data": "money",
      "disabled": true
    },
    "currency": {
      "type": "string",
      "widget": "select",
      "title": "Currency",
      "enum": ["USD", "VND", "EUR", "GBP"],
      "default": "USD",
      "choices": [
        { "key": "USD", "value": "US Dollar" },
        { "key": "VND", "value": "Vietnamese Dong" },
        { "key": "EUR", "value": "Euro" },
        { "key": "GBP", "value": "British Pound" }
      ]
    },
    "status": {
      "type": "string",
      "widget": "select",
      "title": "Order Status",
      "enum": ["pending", "confirmed", "processing", "shipped", "delivered", "cancelled", "refunded"],
      "default": "pending",
      "choices": [
        { "key": "pending", "value": "Pending" },
        { "key": "confirmed", "value": "Confirmed" },
        { "key": "processing", "value": "Processing" },
        { "key": "shipped", "value": "Shipped" },
        { "key": "delivered", "value": "Delivered" },
        { "key": "cancelled", "value": "Cancelled" },
        { "key": "refunded", "value": "Refunded" }
      ]
    },
    "orderDate": {
      "type": "string",
      "widget": "dateTime",
      "title": "Order Date",
      "format": "date-time",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$",
      "displayFormat": "yyyy/MM/dd HH:mm:ss",
      "formatDate": "date-time",
      "field": "single",
      "mode": "dateTime"
    },
    "shippedDate": {
      "type": "string",
      "widget": "dateTime",
      "title": "Shipped Date",
      "format": "date-time",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$",
      "displayFormat": "yyyy/MM/dd HH:mm:ss",
      "formatDate": "date-time",
      "field": "single",
      "mode": "dateTime"
    },
    "deliveredDate": {
      "type": "string",
      "widget": "dateTime",
      "title": "Delivered Date",
      "format": "date-time",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$",
      "displayFormat": "yyyy/MM/dd HH:mm:ss",
      "formatDate": "date-time",
      "field": "single",
      "mode": "dateTime"
    },
    "notes": {
      "type": "string",
      "widget": "textarea",
      "title": "Order Notes",
      "maxLength": 1000,
      "pattern": "^[\\s\\S]{0,1000}$",
      "customRole": "textarea"
    },
    "createdAt": {
      "type": "string",
      "widget": "dateTime",
      "title": "Created At",
      "format": "date-time",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$",
      "displayFormat": "yyyy/MM/dd HH:mm:ss",
      "formatDate": "date-time",
      "disabled": true,
      "field": "single",
      "mode": "dateTime"
    },
    "updatedAt": {
      "type": "string",
      "widget": "dateTime",
      "title": "Updated At",
      "format": "date-time",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$",
      "displayFormat": "yyyy/MM/dd HH:mm:ss",
      "formatDate": "date-time",
      "disabled": true,
      "field": "single",
      "mode": "dateTime"
    }
  },
  "required": ["orderNumber", "customerId", "items", "shippingAddress", "payment", "subtotal", "totalAmount", "status", "orderDate"],
  "additionalProperties": false,
  "relationships": {
    "customer": {
      "type": "belongsTo",
      "collection": "users",
      "foreignKey": "customerId",
      "localField": "customerId",
      "foreignField": "_id",
      "alias": "customer",
      "description": "Customer who placed this order",
      "validation": {
        "required": true
      },
      "widget": "relation",
      "typeRelation": {
        "type": "n-1",
        "_id": "users"
      }
    }
  }
}