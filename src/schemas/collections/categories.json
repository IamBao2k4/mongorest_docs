{
  "$schema": "http://json-schema.org/draft-07/schema#",
  "title": "Categories Collection",
  "description": "Product categories for e-commerce",
  "type": "object",
  "collection": "categories",
  "indexes": [
    { "fields": { "slug": 1 }, "unique": true },
    { "fields": { "name": 1 } },
    { "fields": { "parentId": 1 } },
    { "fields": { "status": 1, "sortOrder": 1 } }
  ],
  "properties": {
    "_id": {
      "type": "string",
      "widget": "shortAnswer",
      "title": "index",
      "minLength": 2,
      "maxLength": 100,
      "pattern": "^[0-9a-fA-F]{24}$",
      "description": "MongoDB ObjectId",
      "format-data": "none"
    },
    "name": {
      "type": "string",
      "widget": "shortAnswer",
      "title": "Category Name",
      "minLength": 2,
      "maxLength": 100,
      "pattern": "^.{2,100}$",
      "description": "Category name",
      "format-data": "none"
    },
    "slug": {
      "type": "string",
      "widget": "UriKeyGen",
      "title": "URL Slug",
      "pattern": "^[a-z0-9]+(?:-[a-z0-9]+)*$",
      "description": "URL-friendly category identifier"
    },
    "description": {
      "type": "string",
      "widget": "textarea",
      "title": "Description",
      "maxLength": 500,
      "pattern": "^[\\s\\S]{0,500}$",
      "description": "Category description",
      "customRole": "textarea"
    },
    "parentId": {
      "type": "string",
      "widget": "relation",
      "title": "Parent Category",
      "pattern": "^[0-9a-fA-F]{24}$",
      "description": "Parent category ID for hierarchical categories",
      "typeRelation": {
        "title": "Parent Category",
        "entity": "categories",
        "type": "n-1",
        "filter": {
          "combinator": "and",
          "rules": [],
          "id": "parent-category-filter"
        }
      }
    },
    "image": {
      "type": "string",
      "widget": "file",
      "title": "Category Image",
      "format": "uri",
      "pattern": "^(https?://|/).*\\.(jpg|jpeg|png|gif|webp|svg)$",
      "description": "Category image URL",
      "meta": "Upload category image"
    },
    "sortOrder": {
      "type": "integer",
      "widget": "numberInput",
      "title": "Sort Order",
      "minimum": 0,
      "default": 0,
      "pattern": "^\\d+$",
      "description": "Display order",
      "format-data": "none"
    },
    "featured": {
      "type": "boolean",
      "widget": "boolean",
      "title": "Featured Category",
      "default": false,
      "pattern": "^(true|false)$",
      "description": "Whether this category is featured",
      "appearance": "checkbox"
    },
    "status": {
      "type": "string",
      "widget": "select",
      "title": "Status",
      "enum": ["active", "inactive"],
      "default": "active",
      "pattern": "^(active|inactive)$",
      "choices": [
        {
          "key": "active",
          "value": "Active"
        },
        {
          "key": "inactive",
          "value": "Inactive"
        }
      ],
      "allowNull": false,
      "isMultiple": false
    },
    "seo": {
      "type": "object",
      "title": "SEO Settings",
      "properties": {
        "metaTitle": { 
          "type": "string",
          "widget": "shortAnswer",
          "title": "Meta Title",
          "maxLength": 60,
          "pattern": "^.{0,60}$",
          "format-data": "none"
        },
        "metaDescription": { 
          "type": "string",
          "widget": "textarea",
          "title": "Meta Description",
          "maxLength": 160,
          "pattern": "^[\\s\\S]{0,160}$",
          "customRole": "textarea"
        },
        "keywords": {
          "type": "array",
          "widget": "array",
          "title": "Keywords",
          "items": { 
            "type": "string",
            "widget": "shortAnswer",
            "pattern": "^.{0,50}$"
          },
          "maxItems": 10,
          "minItems": 0
        }
      }
    },
    "createdAt": {
      "type": "string",
      "widget": "dateTime",
      "title": "Created At",
      "format": "date-time",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$",
      "displayFormat": "yyyy/MM/dd HH:mm:ss",
      "formatDate": "date-time",
      "disabled": true,
      "field": "single",
      "mode": "dateTime"
    },
    "updatedAt": {
      "type": "string",
      "widget": "dateTime",
      "title": "Updated At",
      "format": "date-time",
      "pattern": "^\\d{4}-\\d{2}-\\d{2}T\\d{2}:\\d{2}:\\d{2}(\\.\\d{3})?Z?$",
      "displayFormat": "yyyy/MM/dd HH:mm:ss",
      "formatDate": "date-time",
      "disabled": true,
      "field": "single",
      "mode": "dateTime"
    }
  },
  "required": ["name", "slug"],
  "additionalProperties": false,
  "relationships": {
    "parent": {
      "type": "belongsTo",
      "collection": "categories",
      "foreignKey": "parentId",
      "localField": "parentId",
      "foreignField": "_id",
      "alias": "parent",
      "description": "Parent category",
      "widget": "relation",
      "typeRelation": {
        "type": "n-1",
        "entity": "categories"
      }
    },
    "children": {
      "type": "hasMany",
      "collection": "categories",
      "localField": "_id",
      "foreignField": "parentId",
      "alias": "children",
      "description": "Child categories",
      "defaultSort": { "sortOrder": 1, "name": 1 }
    },
    "products": {
      "type": "manyToMany",
      "collection": "products",
      "through": "product_categories",
      "localField": "_id",
      "throughLocalField": "categoryId",
      "throughForeignField": "productId",
      "foreignField": "_id",
      "alias": "products",
      "description": "Products in this category"
    }
  }
}